<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ë™ë¬¼ì´ë¦„ ììŒëª¨ìŒíƒì • â€” v6 (4x4, 5x5 ê²©ì Â· 100ë‹¨ì–´)</title>
<style>
  :root{--bg:#fffaf2; --ink:#222; --success:#19b77a; --muted:#333; --card:#ffffff; --border:#e9e9e9; --accent:#3e7bff;}
  html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Pretendard,Apple SD Gothic Neo,Noto Sans KR,sans-serif}
  .wrap{max-width:920px;margin:0 auto;padding:18px 16px 40px}
  header{display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap;margin-bottom:10px}
  h1{font-size:20px;margin:0}
  .controls{display:flex;gap:8px;flex-wrap:wrap}
  .btn{appearance:none;border:0;border-radius:12px;padding:10px 14px;font-weight:800;background:var(--accent);color:#fff;cursor:pointer}
  .btn.secondary{background:#eee;color:#333}
  .btn.toggle{background:#fff;color:#333;border:2px solid #ddd}
  .btn.toggle.active{border-color:var(--accent);color:var(--accent)}
  .card{background:var(--card);border-radius:16px;box-shadow:0 6px 18px rgba(0,0,0,.07);padding:12px 14px;display:flex;gap:10px;align-items:center;flex-wrap:wrap;border:1px solid var(--border)}
  .badge{display:inline-flex;gap:6px;align-items:center;background:#f5f7ff;color:#2d3d7a;border:1px solid #d8e0ff;border-radius:999px;padding:6px 10px;font-weight:700}
  .scene{position:relative;margin-top:12px;border-radius:16px;overflow:hidden;background:#fff;border:1px solid var(--border)}
  .scene::before{content:"";display:block;padding-top:70%}
  svg{position:absolute;inset:0;width:100%;height:100%}
  .letter{fill:var(--muted);font-weight:900;cursor:pointer;user-select:none;paint-order:stroke;stroke:#fff;stroke-width:2px}
  .letter.correct{fill:var(--success)!important;pointer-events:none}
  .letter.wrong{animation:shake .18s linear}
  @keyframes shake{0%,100%{transform:translate(0,0)}25%{transform:translate(-1.6px,0)}50%{transform:translate(1.6px,0)}75%{transform:translate(-1px,0)}}
  .chip{background:#fff;border:1px dashed #ddd;border-radius:10px;padding:6px 10px;font-weight:800;margin-right:6px}
  .chip.done{background:#eafff4;border-color:#b9f0d6;color:#0c8a5b}
  .row{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
  .hint{font-size:13px;color:#666;margin-top:8px}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>ë™ë¬¼ì´ë¦„ ììŒëª¨ìŒíƒì • <span style="font-size:14px;color:#666">| v6</span></h1>
    <div class="controls">
      <button id="easyBtn" class="btn toggle active" type="button">ë‚œì´ë„ í•˜ Â· 4Ã—4</button>
      <button id="hardBtn" class="btn toggle" type="button">ë‚œì´ë„ ìƒ Â· 5Ã—5</button>
      <button id="newWord" class="btn" type="button">âœ¨ ìƒˆë¡œìš´ ë™ë¬¼ ë‹¨ì–´</button>
      <button id="reshuffle" class="btn secondary" type="button">ë‹¤ì‹œ ì„ê¸°</button>
    </div>
  </header>

  <div class="card">
    <div class="badge">ğŸ¯ <span id="prompt"></span></div>
    <div class="row">ï½œ ì°¾ì•„ì•¼ í•  ê¸€ì(ëª¨ë‘): <span id="targets" style="display:inline-block"></span></div>
  </div>

  <div class="scene" id="scene" aria-label="í¼ì¦ ì¥ë©´ (í´ë¦­í•´ì„œ ê¸€ìë¥¼ ì°¾ì•„ìš”)"></div>

  <div class="hint">â€» ê²©ì ê³ ì • ë°°ì¹˜ë¡œ ë¹ˆì¹¸ ì—†ì´ ê½‰ ì±„ì›ë‹ˆë‹¤. ê°™ì€ ë‹¨ì–´ë„ ë§¤ë²ˆ <b>ìœ„ì¹˜ê°€ ëœë¤</b>ì´ì—ìš”. (íŒíŠ¸ìƒ‰ ì—†ìŒ, ë§ì¶˜ ê¸€ìë§Œ ì´ˆë¡ìƒ‰)</div>
</div>

<script>
const WORDS = ["ê°•ì•„ì§€", "ê³ ì–‘ì´", "í† ë¼", "í–„ìŠ¤í„°", "ê¸°ë¦°", "ì½”ë¼ë¦¬", "ì‚¬ì", "í˜¸ë‘ì´", "í‘œë²”", "ì¹˜íƒ€", "í•˜ë§ˆ", "ì½”ë¿”ì†Œ", "ê³°", "íŒë‹¤", "ì—¬ìš°", "ëŠ‘ëŒ€", "ìŠ¤ë¼ì†Œë‹ˆ", "ë„ˆêµ¬ë¦¬", "ì˜¤ì†Œë¦¬", "ìˆ˜ë‹¬", "ë‹¤ëŒì¥", "ê³ ìŠ´ë„ì¹˜", "ë‘ë”ì§€", "ë‘ë£¨ë¯¸", "ì°¸ìƒˆ", "ë¹„ë‘˜ê¸°", "ë…ìˆ˜ë¦¬", "ë¶€ì—‰ì´", "ì˜¬ë¹¼ë¯¸", "ê¹Œì¹˜", "ê¹Œë§ˆê·€", "ì•µë¬´ìƒˆ", "íƒ€ì¡°", "í­ê·„", "ë°”ë‹¤í‘œë²”", "í•´ë‹¬", "ëŒê³ ë˜", "ê³ ë˜", "ìƒì–´", "ë¬¸ì–´", "ì˜¤ì§•ì–´", "ê²Œ", "ê°€ì¬", "ìƒˆìš°", "í•´íŒŒë¦¬", "ê±°ë¶ì´", "ë„ë§ˆë±€", "ì•…ì–´", "ê°œêµ¬ë¦¬", "ë‘êº¼ë¹„", "ë©”ëšœê¸°", "ì‚¬ë§ˆê·€", "ì ìë¦¬", "ë‚˜ë¹„", "ê¿€ë²Œ", "ê°œë¯¸", "ë”±ì •ë²Œë ˆ", "ëª¨ê¸°", "íŒŒë¦¬", "í’ë…ì´", "ë§", "ì†Œ", "ë¼ì§€", "ì–‘", "ì—¼ì†Œ", "ë‹­", "ì˜¤ë¦¬", "ê±°ìœ„", "ì¹ ë©´ì¡°", "ê³µì‘", "ë³‘ì•„ë¦¬", "ë¹„ë²„", "ì•ŒíŒŒì¹´", "ë¼ë§ˆ", "ì¹´í”¼ë°”ë¼", "í•˜ì´ì—ë‚˜", "ë¯¸ì–´ìº£", "ì¹´ë©œë ˆì˜¨", "ì´êµ¬ì•„ë‚˜", "ë§¹ê½ì´", "ê³ ë¼ë‹ˆ", "ì‚¬ìŠ´", "ë…¸ë£¨", "ì‚°ì–‘", "ë°”ë‹¤ì‚¬ì", "ë°”ë‹¤ì½”ë¼ë¦¬", "ì²­ì„¤ëª¨", "ì°¸ê±°ë¶", "ê³ ë˜ìƒì–´", "ë¼ì¿¤", "í“¨ë§ˆ", "ìŠ¤ì»¹í¬", "í˜¸ì €", "ë‹´ë¹„", "ë„ˆêµ¬ë¦¬ê°•", "ì‚´ëª¨ì‚¬", "ë„ë£¡ë‡½", "í‘œë²”ë„ë§ˆë±€", "ë¶‰ì€ì—¬ìš°", "ì‚°í† ë¼"];

const CHO=["ã„±","ã„²","ã„´","ã„·","ã„¸","ã„¹","ã…","ã…‚","ã…ƒ","ã……","ã…†","ã…‡","ã…ˆ","ã…‰","ã…Š","ã…‹","ã…Œ","ã…","ã…"];
const JUNG=["ã…","ã…","ã…‘","ã…’","ã…“","ã…”","ã…•","ã…–","ã…—","ã…˜","ã…™","ã…š","ã…›","ã…œ","ã…","ã…","ã…Ÿ","ã… ","ã…¡","ã…¢","ã…£"];
const JONG=["","ã„±","ã„²","ã„³","ã„´","ã„µ","ã„¶","ã„·","ã„¹","ã„º","ã„»","ã„¼","ã„½","ã„¾","ã„¿","ã…€","ã…","ã…‚","ã…„","ã……","ã…†","ã…‡","ã…ˆ","ã…Š","ã…‹","ã…Œ","ã…","ã…"];

function splitHangulFull(word){const base=0xAC00,arr=[];for(const ch of word){const code=ch.codePointAt(0);if(code>=0xAC00&&code<=0xD7A3){const s=code-base,cho=Math.floor(s/(21*28)),jung=Math.floor((s%(21*28))/28),jong=s%28;arr.push(CHO[cho],JUNG[jung]);if(JONG[jong]!="")arr.push(JONG[jong]);}}return arr;}

function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a;}

function el(tag, attrs={}, children=[]){const ns="http://www.w3.org/2000/svg";const e=document.createElementNS(ns,tag);for(const[k,v]of Object.entries(attrs))e.setAttribute(k,v);for(const c of children)e.appendChild(c);return e;}

function buildGrid(svg, totalCells){const cols=Math.sqrt(totalCells)|0;const rows=cols;const cellW=100/cols;const cellH=70/rows;const font=Math.min(cellW,cellH)*0.65;const cells=[];for(let r=0;r<rows;r++)for(let c=0;c<cols;c++)cells.push([r,c]);shuffle(cells);return {cells,cellW,cellH,font,rows,cols};}

let difficulty="easy"; // easy=4x4, hard=5x5
let currentWord="";

function render(newRandom=false){
  if(newRandom||!currentWord)currentWord=WORDS[Math.floor(Math.random()*WORDS.length)];
  const totalCells=difficulty==="easy"?16:25;

  const sceneEl=document.getElementById("scene");sceneEl.innerHTML="";
  const svg=el("svg");svg.setAttribute("viewBox","0 0 100 70");svg.setAttribute("role","img");svg.setAttribute("aria-label",currentWord+" í¼ì¦");
  sceneEl.appendChild(svg);
  svg.appendChild(el("rect",{x:0,y:0,width:"100%",height:"100%",fill:"#fff"}));

  const targets=splitHangulFull(currentWord); // duplicates kept
  const distractorPool=["ã„±","ã„´","ã„·","ã„¹","ã…","ã…‚","ã……","ã…‡","ã…ˆ","ã…Š","ã…‹","ã…Œ","ã…","ã…","ã…","ã…“","ã…—","ã…œ","ã…¡","ã…£","ã…","ã…”"];
  const letters=targets.slice();
  while(letters.length<totalCells)letters.push(distractorPool[Math.floor(Math.random()*distractorPool.length)]);
  shuffle(letters);

  const grid=buildGrid(svg,totalCells);
  const nodes=[];
  letters.forEach(ch=>{const n=el("text",{class:"letter","data-ch":ch,"text-anchor":"middle","font-size":String(grid.font)});n.textContent=ch;nodes.push(n);});
  for(let i=0;i<nodes.length;i++){const [r,c]=grid.cells[i];const x=c*grid.cellW+grid.cellW/2;const y=r*grid.cellH+grid.cellH*0.7;nodes[i].setAttribute("x",x);nodes[i].setAttribute("y",y);svg.appendChild(nodes[i]);}

  document.getElementById("prompt").textContent="â€˜"+currentWord+"â€™ ë‹¨ì–´ì˜ ê¸€ìë¥¼ ëª¨ë‘ ì°¾ìœ¼ì„¸ìš”";
  const tg=document.getElementById("targets");tg.innerHTML="";
  const remaining=targets.slice();
  function refreshChips(){tg.innerHTML="";remaining.forEach(ch=>{const span=document.createElement("span");span.className="chip";span.textContent=ch;tg.appendChild(span);});if(remaining.length===0){const done=document.createElement("span");done.className="chip done";done.textContent="ì™„ë£Œ!";tg.appendChild(done);}}
  refreshChips();

  nodes.forEach(n=>{n.addEventListener("click",()=>{const ch=n.getAttribute("data-ch");const idx=remaining.indexOf(ch);if(idx>-1){remaining.splice(idx,1);n.classList.add("correct");refreshChips();}else{n.classList.add("wrong");setTimeout(()=>n.classList.remove("wrong"),140);}}, {passive:true});});
}

document.getElementById("newWord").addEventListener("click",()=>render(true));
document.getElementById("reshuffle").addEventListener("click",()=>render(false));
document.getElementById("easyBtn").addEventListener("click",()=>{difficulty="easy";document.getElementById("easyBtn").classList.add("active");document.getElementById("hardBtn").classList.remove("active");render(false);});
document.getElementById("hardBtn").addEventListener("click",()=>{difficulty="hard";document.getElementById("hardBtn").classList.add("active");document.getElementById("easyBtn").classList.remove("active");render(false);});
render(true);
</script>
</body>
</html>
